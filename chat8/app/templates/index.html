<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body> 
    <h1>Group Name: {{groupname}}</h1>

    <textarea id="chat-log" cols="100" rows="20">

        {% for chat in chats %}
        {{chat.content}}
        {% endfor %}

    </textarea> <br/>
    <input type="text" id="chat-sms-input" size="100">
    <input type="button" value="send" id="chat-sms-submit">
   
    <h1>{{groupname|json_script:"group-name"}}</h1>


    <script>
        const groupName = JSON.parse(document.getElementById('group-name').textContent)
        //var ws = new WebSocket('ws://localhost:8000/ws/ac/')
        
        var ws = new WebSocket(
            'ws://'
            + window.location.host
            +'/ws/ac/'
            + groupName
            +'/'
            )

        
        console.log('group name here..', groupName)
       
        ws.onopen = function(){
            console.log('WebSocket connection open...')
            
        } 
        
        
        // data is received here from server
        ws.onmessage = function(event){
            console.log('EVENT', event)
            console.log('SMS received efrom server...', event.data)
            console.log('data type...', typeof(event.data))
         
            var data = JSON.parse(event.data)  // json string to js opject
            console.log('Username...', data.user)
            console.log('new data type', typeof(data))
        
            document.querySelector('#chat-log').value+=(data.user + ":" + data.msg+ '\n')
        }
        ws.onerror = function(event){
            console.log('websocket error occurred...', event)
        }

        ws.onclose = function(event){
            console.log('websocket connection closed..', event)
        } 


        //from here we send sms to server and server process it according to requirements

        document.getElementById('chat-sms-submit').onclick=
           function(event){
               const messageInputDom = document.getElementById('chat-sms-input')

               const message = messageInputDom.value

               console.log('message.............', message)
               ws.send(JSON.stringify({
                'msg': message
            }))
               messageInputDom.value = ''
               
              
             }


        {% comment %} ws.addEventListener('open', () =>{
            console.log('WebSocket connection open...')
            ws.send('Hi sms from client site')
        })
        ws.addEventListener('message', (event) =>{
            console.log('SMS received from server...', event)
            
        })
        ws.addEventListener('error', (event) =>{

            console.log('websocket error occurred...', event)
              
        })
        ws.addEventListener('close', (event) =>{
            console.log('websocket connection closed..', event)
            
        }) {% endcomment %}
         


    </script>
</body>
</html>